<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validating User Input | Jalu P. Rumekso</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Jalu&#39;s personal website">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.06f9ed6f.css" as="style"><link rel="preload" href="/assets/js/app.bf6a9019.js" as="script"><link rel="preload" href="/assets/js/2.75302286.js" as="script"><link rel="preload" href="/assets/js/25.edfa72b6.js" as="script"><link rel="prefetch" href="/assets/js/10.fe6673c7.js"><link rel="prefetch" href="/assets/js/11.93056b08.js"><link rel="prefetch" href="/assets/js/12.ae155c4d.js"><link rel="prefetch" href="/assets/js/13.74b04675.js"><link rel="prefetch" href="/assets/js/14.ef0cf3d1.js"><link rel="prefetch" href="/assets/js/15.75a14e6d.js"><link rel="prefetch" href="/assets/js/16.907d4ee1.js"><link rel="prefetch" href="/assets/js/17.9214da0c.js"><link rel="prefetch" href="/assets/js/18.4a36748f.js"><link rel="prefetch" href="/assets/js/19.cb613fcb.js"><link rel="prefetch" href="/assets/js/20.839bb821.js"><link rel="prefetch" href="/assets/js/21.2b4fef43.js"><link rel="prefetch" href="/assets/js/22.67180148.js"><link rel="prefetch" href="/assets/js/23.f60b0a5b.js"><link rel="prefetch" href="/assets/js/24.a135ddac.js"><link rel="prefetch" href="/assets/js/26.03a0a6bb.js"><link rel="prefetch" href="/assets/js/27.bac5f71e.js"><link rel="prefetch" href="/assets/js/28.6495ee6d.js"><link rel="prefetch" href="/assets/js/29.bb94a77f.js"><link rel="prefetch" href="/assets/js/3.83754c82.js"><link rel="prefetch" href="/assets/js/30.8aad4159.js"><link rel="prefetch" href="/assets/js/4.ff3f8220.js"><link rel="prefetch" href="/assets/js/5.744a4355.js"><link rel="prefetch" href="/assets/js/6.6e8c67be.js"><link rel="prefetch" href="/assets/js/7.2605c6ec.js"><link rel="prefetch" href="/assets/js/8.b1ef522a.js"><link rel="prefetch" href="/assets/js/9.17f2ad84.js">
    <link rel="stylesheet" href="/assets/css/0.styles.06f9ed6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jalu P. Rumekso</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Books" class="dropdown-title"><span class="title">Books</span> <span class="arrow down"></span></button> <button type="button" aria-label="Books" class="mobile-dropdown-title"><span class="title">Books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/books/hapi-mysql/introduction.html" class="nav-link">
  Learn Hapi/MySQL
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Contact
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Books" class="dropdown-title"><span class="title">Books</span> <span class="arrow down"></span></button> <button type="button" aria-label="Books" class="mobile-dropdown-title"><span class="title">Books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/books/hapi-mysql/introduction.html" class="nav-link">
  Learn Hapi/MySQL
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Contact
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/hapi-mysql/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/books/hapi-mysql/setup.html" class="sidebar-link">Project Setup</a></li><li><a href="/books/hapi-mysql/server.html" class="sidebar-link">Creating Server</a></li><li><a href="/books/hapi-mysql/routes.html" class="sidebar-link">Adding Routes</a></li><li><a href="/books/hapi-mysql/validation.html" aria-current="page" class="active sidebar-link">Validating User Input</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/hapi-mysql/validation.html#joi" class="sidebar-link">Joi</a></li><li class="sidebar-sub-header"><a href="/books/hapi-mysql/validation.html#using-joi-with-hapi" class="sidebar-link">Using Joi with Hapi</a></li><li class="sidebar-sub-header"><a href="/books/hapi-mysql/validation.html#throwing-joi-s-original-error" class="sidebar-link">Throwing Joi's Original Error</a></li></ul></li><li><a href="/books/hapi-mysql/response.html" class="sidebar-link">Response Toolkit</a></li><li><a href="/books/hapi-mysql/error.html" class="sidebar-link">Error Handling</a></li><li><a href="/books/hapi-mysql/database.html" class="sidebar-link">Using MySQL</a></li><li><a href="/books/hapi-mysql/modularity.html" class="sidebar-link">Achieving Modularity</a></li><li><a href="/books/hapi-mysql/authentication.html" class="sidebar-link">Authentication</a></li><li><a href="/books/hapi-mysql/authorization.html" class="sidebar-link">Authorization</a></li><li><a href="/books/hapi-mysql/deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/books/hapi-mysql/closing.html" class="sidebar-link">Congratulations!</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="validating-user-input"><a href="#validating-user-input" class="header-anchor">#</a> Validating User Input</h1> <p>Today Joe wants to enhance his app with a layer of validation. He thinks validation is a basic requirement to prevent nonsensical inputs.</p> <h2 id="joi"><a href="#joi" class="header-anchor">#</a> Joi</h2> <p>Thankfully, there is a wonderful library that can help him achieve this goal easily. The library is Joi (funny enough, it has a similar name to Joe). On its site, Joi describes himself as &quot;the most powerful schema description language and data validator for JavaScript&quot;. Awesome!</p> <p>Without further ado, Joe begins adding Joi to his project by running <code>npm install joi</code>. Then as usual, before he can do amazing things with the library, he needs to require it and store it in a variable: <code>const Joi = require(&quot;joi&quot;)</code>.</p> <p>The documentation says that he can start using Joi by defining his data first. Then that data definition will be used to validate the incoming input. Defining data is done by calling the available methods on Joi instance. At <a href="https://joi.dev/api/?v=17.4.0" target="_blank" rel="noopener noreferrer">Joi's official documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> he finds a comprehensive list of the available methods. Here are some that picks Joe's interest:</p> <ul><li>string() which means it must be a string,</li> <li>min() chained after string() to define the minimum string characters,</li> <li>max() chained after string() to define the maximum string characters,</li> <li>required() which means it is required,</li> <li>integer() which means it must be an integer, etc.</li></ul> <p>Joe finds the methods are self-explanatory so he thought it must be easy to learn the others as well for a more complex use case later.</p> <p>Joe reviews his store data. It has three properties: id, name, and address. The id will be generated automatically by the database so he doesn't need to worry about it. For the name, it's obviously must be a string. And since it's the main descriptor of a store, he wants it to be classified as required. Also, he wants its length to be 30 characters at max. For the address, he only wants it to be a string. So here is his code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> storeSchema <span class="token operator">=</span> Joi<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  address<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="using-joi-with-hapi"><a href="#using-joi-with-hapi" class="header-anchor">#</a> Using Joi with Hapi</h2> <p>Now the question is how to use this schema to validate the request payload in Hapi? Fortunately, Joi integrates very well with Hapi. All Joe needs to do is assigning the schema to <code>options.validate.payload</code> or <code>options.validate.query</code> or <code>options.validate.params</code> of a route, depends on what input he wants to validate. In this case, Joe wants to validate the payload at the create and update store route.</p> <p>Here is how he implements it at the create store route:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">&quot;/api/stores&quot;</span><span class="token punctuation">,</span>
  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newStore <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> stores<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      address<span class="token operator">:</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>address <span class="token operator">??</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    stores<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newStore<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> newStore<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      payload<span class="token operator">:</span> storeSchema<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And here is how he implements it at the update store route (which is identical):</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">&quot;/api/stores/{id}&quot;</span><span class="token punctuation">,</span>
  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">;</span>

    <span class="token keyword">const</span> theStore <span class="token operator">=</span> stores<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    theStore<span class="token punctuation">.</span>name <span class="token operator">=</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>name <span class="token operator">??</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    theStore<span class="token punctuation">.</span>address <span class="token operator">=</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>address <span class="token operator">??</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> theStore<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      payload<span class="token operator">:</span> storeSchema<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then he tests the create store route by sending this request:</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token request-line"><span class="token property">POST</span> http://localhost<span class="token attr-name">:3000</span>/api/stores HTTP/1.1</span>
<span class="token header-name keyword">content-type:</span> application/json<span class="token application-json">

<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>He intentionally assigns an integer to the name property. So how does the app respond?</p> <p>Here is what he gets back from the app:</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">400 Bad Request</span></span>
<span class="token header-name keyword">content-type:</span> application/json; charset=utf-8
<span class="token header-name keyword">cache-control:</span> no-cache
<span class="token header-name keyword">content-length:</span> 82
<span class="token header-name keyword">Date:</span> Sun, 21 Feb 2021 06:44:56 GMT
<span class="token header-name keyword">Connection:</span> close

{
  &quot;statusCode&quot;: 400,
  &quot;error&quot;: &quot;Bad Request&quot;,
  &quot;message&quot;: &quot;Invalid request payload input&quot;
}
</code></pre></div><p>He was greeted by Bad Request error with a message of invalid request payload input. The message clearly indicates that his code works. But he isn't satisfied with the generic error message. Yes, it's true that the payload is invalid, but what's the reason? He wants to know it too.</p> <h2 id="throwing-joi-s-original-error"><a href="#throwing-joi-s-original-error" class="header-anchor">#</a> Throwing Joi's Original Error</h2> <p>As usual, then he goes to his friend asking about &quot;joi hapi validation error&quot;. And as usual, his friend does a good job finding the information that he needs.</p> <p>So here is what he finds. It turned out that since version 17, the Hapi team decided to not send Joi's input validation errors to the client. Hapi will send a generic 400 error instead such as what he saw above. They explain that it's a security consideration. He finds the answer from <a href="https://github.com/hapijs/hapi/issues/3706" target="_blank" rel="noopener noreferrer">this interesting discussion<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Fortunately, Hapi provides a workaround for people like Joe who want to get the original Joi's validation error. It's done by configuring the <code>routes.validate.failAction()</code> on the server configuration object.</p> <p>The <code>failAction()</code> method is an async function. It has three parameters: req, h, and err. The last parameter is where Joi's original error resides. So throwing it will send the error back to the user when the validation fails.</p> <p>Now here is how Joe's server object looks:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> server <span class="token operator">=</span> Hapi<span class="token punctuation">.</span><span class="token function">server</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> <span class="token punctuation">{</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">async</span> <span class="token function">failAction</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> h<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>He throws the error back to the requester also console.log() it so he can inspect it from the terminal as well.</p> <p>Then when he sends the same request as before, he gets this:</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">400 Bad Request</span></span>
<span class="token header-name keyword">content-type:</span> application/json; charset=utf-8
<span class="token header-name keyword">cache-control:</span> no-cache
<span class="token header-name keyword">content-length:</span> 128
<span class="token header-name keyword">Date:</span> Sun, 21 Feb 2021 07:04:48 GMT
<span class="token header-name keyword">Connection:</span> close

{
  &quot;statusCode&quot;: 400,
  &quot;error&quot;: &quot;Bad Request&quot;,
  &quot;message&quot;: &quot;\&quot;name\&quot; must be a string&quot;,
  &quot;validation&quot;: {
    &quot;source&quot;: &quot;payload&quot;,
    &quot;keys&quot;: [
      &quot;name&quot;
    ]
  }
}
</code></pre></div><p>And when he sends an empty name, he gets this:</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">400 Bad Request</span></span>
<span class="token header-name keyword">content-type:</span> application/json; charset=utf-8
<span class="token header-name keyword">cache-control:</span> no-cache
<span class="token header-name keyword">content-length:</span> 123
<span class="token header-name keyword">Date:</span> Sun, 21 Feb 2021 10:31:52 GMT
<span class="token header-name keyword">Connection:</span> close

{
  &quot;statusCode&quot;: 400,
  &quot;error&quot;: &quot;Bad Request&quot;,
  &quot;message&quot;: &quot;\&quot;name\&quot; is required&quot;,
  &quot;validation&quot;: {
    &quot;source&quot;: &quot;payload&quot;,
    &quot;keys&quot;: [
      &quot;name&quot;
    ]
  }
}
</code></pre></div><p>Now Joe feels happier because he receives a more meaningful message. Although Hapi suggests to him not to throw the detailed error, he wants to keep it this way for the development purpose.</p> <p>Then he realizes something that's not quite right.</p> <p>Since he tells Joi that the required property is only the name property, then there'll be a case where the user doesn't send the address. If the user doesn't send the address then Javascript will assign <code>undefined</code> to the address property. Joe doesn't want that. He wants Javascript to assign <code>null</code> instead. So he modifies his code to implement that functionality. Here is how his code looks:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">&quot;/api/stores&quot;</span><span class="token punctuation">,</span>
  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newStore <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> stores<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      address<span class="token operator">:</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>address <span class="token operator">??</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    stores<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newStore<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> newStore<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      payload<span class="token operator">:</span> storeSchema<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">&quot;/api/stores/{id}&quot;</span><span class="token punctuation">,</span>
  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">;</span>

    <span class="token keyword">const</span> theStore <span class="token operator">=</span> stores<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    theStore<span class="token punctuation">.</span>name <span class="token operator">=</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    theStore<span class="token punctuation">.</span>address <span class="token operator">=</span> req<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>address <span class="token operator">??</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> theStore<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      payload<span class="token operator">:</span> storeSchema<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Joe uses the nullish coalescing operator which basically says: is <code>req.payload.address</code> has a value other than <code>undefined</code> or <code>null</code>? If it has, then uses that value, otherwise assign <code>null</code>.</p> <p>With this new modification, then his create/update store route will always returns three properties: id, name, and address that can be a string of address or <code>null</code>.</p> <p>The modification also concludes Joe learning session today. He feels satisfied with the new enhancement on his app. Now he doesn't have to worry about his user sending a number or even empty string to name his store.</p> <p>Next time he wants to learn about the response toolkit.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/books/hapi-mysql/routes.html" class="prev">
        Adding Routes
      </a></span> <span class="next"><a href="/books/hapi-mysql/response.html">
        Response Toolkit
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bf6a9019.js" defer></script><script src="/assets/js/2.75302286.js" defer></script><script src="/assets/js/25.edfa72b6.js" defer></script>
  </body>
</html>
